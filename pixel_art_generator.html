<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pixel Inspector | Mustafa Neto</title>
    <link
      rel="stylesheet"
      href="https://unicons.iconscout.com/release/v4.0.0/css/line.css"
    />
    <link rel="stylesheet" href="./assets/css/style.css" />
  </head>
  <body class="pixel-art">
    <header class="header" id="header">
      <nav class="nav container">
        <a href="index.html" class="nav__logo">Mustafa</a>
        <div class="nav__menu" id="nav-menu">
          <ul class="nav__list grid">
            <li class="nav__item">
              <a href="utilidades.html" class="nav__link">
                <i class="uil uil-apps nav__icon"></i>
                Voltar às Utilidades
              </a>
            </li>
          </ul>
          <i class="uil uil-times nav__close" id="nav-close"></i>
        </div>
        <div class="nav__btns">
          <i class="uil uil-moon change-theme" id="theme-button"></i>
          <div class="nav__toggle" id="nav-toggle">
            <i class="uil uil-apps"></i>
          </div>
        </div>
      </nav>
    </header>

    <main class="main">
      <section class="utilities section" id="utilities">
        <h2 class="section__title">Pixel Inspector</h2>
        <span class="section__subtitle">Ferramenta para inspecionar pixels</span>

        <div class="utilities__container container grid">
          <div class="utilities__content">
            <div class="utilities__header">
              <i class="uil uil-brush-alt utilities__icon"></i>
              <h3 class="utilities__title">Pixel Inspector</h3>
            </div>

            <div class="utilities__tool">
              <p class="utilities__description">
                Clique em um pixel para selecioná-lo e ver suas informações.
                Clique novamente no mesmo pixel para deselecionar.
              </p>

              <div class="row">
                <label>Image: <input id="file" type="file" accept="image/*" /></label>
                <label>Target W: <input id="tw" type="number" value="75" min="1" /></label>
                <label>Target H: <input id="th" type="number" value="76" min="1" /></label>
                <label><input id="resize" type="checkbox" checked /> Resize to target (nearest‑neighbor)</label>
                <label><input id="grid" type="checkbox" checked /> Show grid</label>
                <label><input id="snap" type="checkbox" checked /> Snap to pixel</label>
                <label>Zoom: <input id="zoom" type="range" min="1" max="32" step="1" value="8" /></label>
              </div>

              <div class="pixel-art-container">
                <div class="canvas-container">
                  <canvas id="view" width="800" height="600"></canvas>
                </div>
                <div class="info-panel">
                  <div class="kv">Image size (px): <span id="size">–</span></div>
                  <div class="kv">Cursor (displayed): <span id="pos">–</span></div>
                  <div class="kv">Image coords: <span id="ipos">–</span></div>
                  <div class="kv">
                    Color: <span id="rgb">–</span> <span id="hex">–</span>
                    <span id="sw" class="swatch"></span>
                  </div>
                  <div class="row">
                    <button id="copyHex" disabled>Copy HEX</button>
                    <button id="copyRGB" disabled>Copy RGB</button>
                    <button id="copyColor" disabled>Copy Color</button>
                  </div>
                </div>
              </div>
              
              <div class="custom-origin-section">
                <fieldset>
                  <legend>Custom Origin</legend>
                  <div class="row">
                    <label><input id="customOrigin" type="checkbox" /> Use custom origin</label>
                  </div>
                  <div class="row">
                    <label>OX: <input id="originX" type="number" value="0" /></label>
                    <label>OY: <input id="originY" type="number" value="0" /></label>
                    <button id="setFromHover" title="Set OX/OY from selected pixel">Set from Selection</button>
                  </div>
                  <div class="row row--start">
                    <fieldset>
                      <legend>Mode</legend>
                      <label title="image (0,0) will be displayed as (OX, OY)">
                        <input type="radio" name="originMode" value="offset" checked /> Offset
                      </label><br />
                      <label title="coord (0,0) equals image (OX, OY); e.g., set OX=1723, OY=2424">
                        <input type="radio" name="originMode" value="anchor" /> Anchor
                      </label>
                    </fieldset>
                    <div class="pixel-notes">
                      <b>Offset</b>: displayed = (imgX + OX, imgY + OY).<br />
                      <b>Anchor</b>: displayed = (imgX − OX, imgY − OY).<br />
                      Example: to make <i>coord (0,0)</i> be image pixel <i>(1723,2424)</i>, choose <b>Anchor</b> and set OX=<b>1723</b>, OY=<b>2424</b>.
                    </div>
                  </div>
                </fieldset>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
<footer class="footer">
  <div class="footer__bg">
    <div class="footer__container container grid">
      <div>
        <h1 class="footer__title">Mustafa</h1>
        <span class="footer__subtitle"> Desenvolvedor Fullstack </span>
      </div>
      <ul class="footer__links">
        <li>
          <a href="index.html" class="footer__link">Portfólio</a>
        </li>
      </ul>
      <div class="footer__socials">
        <a href="https://github.com/mustafaneto" target="_blank" class="footer__social"><i class="uil uil-github-alt"></i></a>
        <a href="https://www.linkedin.com/in/mustafaneto/" target="_blank" class="footer__social"><i class="uil uil-linkedin-alt"></i></a>
      </div>
    </div>
  </div>
</footer>

  <script>
(() => {
  const $ = id => document.getElementById(id);
  const file = $('file');
  const canvas = $('view');
  const ctx = canvas.getContext('2d', { willReadFrequently: true });
  const zoomEl = $('zoom');
  const gridEl = $('grid');
  const snapEl = $('snap');
  const resizeEl = $('resize');
  const twEl = $('tw');
  const thEl = $('th');
  const sizeEl = $('size');
  const posEl = $('pos');
  const iposEl = $('ipos');
  const rgbEl = $('rgb');
  const hexEl = $('hex');
  const sw = $('sw');
  const copyHex = $('copyHex');
  const copyRGB = $('copyRGB');
  const copyColor = $('copyColor');
  const customOriginEl = $('customOrigin');
  const originXEl = $('originX');
  const originYEl = $('originY');
  const setFromHoverBtn = $('setFromHover');
  const originModeEls = document.querySelectorAll('input[name="originMode"]');
  let base = document.createElement('canvas');
  let bctx = base.getContext('2d', { willReadFrequently: true });
  let zoom = +zoomEl.value;
  const palette = [
    [0, 0, 0],
    [60, 60, 60],
    [120, 120, 120],
    [170, 170, 170],
    [210, 210, 210],
    [255, 255, 255],
    [96, 0, 24],
    [165, 14, 30],
    [237, 28, 36],
    [250, 128, 114],
    [228, 92, 26],
    [255, 127, 39],
    [246, 170, 9],
    [249, 221, 59],
    [255, 250, 188],
    [156, 132, 49],
    [197, 173, 49],
    [232, 212, 95],
    [74, 107, 58],
    [90, 148, 74],
    [132, 197, 115],
    [14, 185, 104],
    [19, 230, 123],
    [135, 255, 94],
    [12, 129, 110],
    [16, 174, 166],
    [19, 225, 190],
    [15, 121, 159],
    [96, 247, 242],
    [187, 250, 242],
    [40, 80, 158],
    [64, 147, 228],
    [125, 199, 255],
    [77, 49, 184],
    [107, 80, 246],
    [153, 177, 251],
    [74, 66, 132],
    [122, 113, 196],
    [181, 174, 241],
    [120, 12, 153],
    [170, 56, 185],
    [224, 159, 249],
    [203, 0, 122],
    [236, 31, 128],
    [243, 141, 169],
    [155, 82, 73],
    [209, 128, 120],
    [250, 182, 164],
    [104, 70, 52],
    [149, 104, 42],
    [219, 164, 99],
    [123, 99, 82],
    [156, 132, 107],
    [214, 181, 148],
    [209, 128, 81],
    [248, 178, 119],
    [255, 197, 165],
    [109, 100, 63],
    [148, 140, 107],
    [205, 197, 158],
    [51, 57, 65],
    [109, 117, 141],
    [179, 185, 209]
  ];
  function currentOriginMode() {
    return [...originModeEls].find(r => r.checked)?.value || 'offset';
  }
  function setZoom(z) { zoom = +z; draw(); }
  function loadImage(img) {
    const targetW = Math.max(1, +twEl.value|0);
    const targetH = Math.max(1, +thEl.value|0);
    const src = document.createElement('canvas');
    const sctx = src.getContext('2d');
    src.width = img.naturalWidth;
    src.height = img.naturalHeight;
    sctx.drawImage(img, 0, 0);
    if (resizeEl.checked) {
      base.width = targetW;
      base.height = targetH;
      bctx.imageSmoothingEnabled = false;
      bctx.clearRect(0,0,base.width,base.height);
      bctx.drawImage(src, 0, 0, src.width, src.height, 0, 0, targetW, targetH);
    } else {
      base.width = src.width;
      base.height = src.height;
      bctx.clearRect(0,0,base.width,base.height);
      bctx.drawImage(src, 0, 0);
    }
    sizeEl.textContent = `${base.width} × ${base.height}`;
    applyPalette();
    draw();
  }

  function applyPalette() {
    const imgData = bctx.getImageData(0, 0, base.width, base.height);
    const data = imgData.data;
    for (let i = 0; i < data.length; i += 4) {
      const r = data[i], g = data[i + 1], b = data[i + 2];
      let best = palette[0];
      let bestDist = Infinity;
      for (const col of palette) {
        const dr = r - col[0];
        const dg = g - col[1];
        const db = b - col[2];
        const dist = dr * dr + dg * dg + db * db;
        if (dist < bestDist) {
          bestDist = dist;
          best = col;
        }
      }
      data[i] = best[0];
      data[i + 1] = best[1];
      data[i + 2] = best[2];
    }
    bctx.putImageData(imgData, 0, 0);
  }
  function draw() {
    canvas.width = base.width * zoom;
    canvas.height = base.height * zoom;
    ctx.imageSmoothingEnabled = false;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(base, 0, 0, base.width, base.height, 0, 0, canvas.width, canvas.height);
    if (gridEl.checked && zoom >= 3) {
      ctx.save();
      ctx.strokeStyle = 'rgba(0,0,0,0.25)';
      ctx.lineWidth = 1;
      for (let x = 0; x <= base.width; x++) {
        ctx.beginPath();
        ctx.moveTo(x * zoom + 0.5, 0);
        ctx.lineTo(x * zoom + 0.5, canvas.height);
        ctx.stroke();
      }
      for (let y = 0; y <= base.height; y++) {
        ctx.beginPath();
        ctx.moveTo(0, y * zoom + 0.5);
        ctx.lineTo(canvas.width, y * zoom + 0.5);
        ctx.stroke();
      }
      ctx.restore();
    }
    
    // Desenha indicador do pixel selecionado
    if (selectedPixel) {
      ctx.save();
      ctx.strokeStyle = '#ff0000';
      ctx.lineWidth = 2;
      const x = selectedPixel.x * zoom;
      const y = selectedPixel.y * zoom;
      ctx.strokeRect(x, y, zoom, zoom);
      ctx.restore();
    }
  }
  function getPixel(x, y) {
    if (x < 0 || y < 0 || x >= base.width || y >= base.height) return null;
    const d = bctx.getImageData(x, y, 1, 1).data;
    const rgb = `rgb(${d[0]}, ${d[1]}, ${d[2]})`;
    const hex = '#' + [d[0], d[1], d[2]].map(v => v.toString(16).padStart(2, '0')).join('');
    return { r: d[0], g: d[1], b: d[2], a: d[3], rgb, hex };
  }
  function displayFromImage(px, py) {
    const ox = +originXEl.value || 0;
    const oy = +originYEl.value || 0;
    const mode = currentOriginMode();
    if (!customOriginEl.checked) return { x: px, y: py };
    if (mode === 'offset') return { x: px + ox, y: py + oy };
    else return { x: px - ox, y: py - oy };
  }
  function updateInfo(px, py) {
    if (px == null || py == null) {
      posEl.textContent = '–';
      iposEl.textContent = '–';
    } else {
      const disp = displayFromImage(px, py);
      posEl.textContent = `(${disp.x}, ${disp.y})`;
      iposEl.textContent = `(${px}, ${py})`;
    }
    const p = (px == null) ? null : getPixel(px, py);
    if (!p) {
      rgbEl.textContent = '–';
      hexEl.textContent = '–';
      sw.style.background = 'transparent';
      copyHex.disabled = copyRGB.disabled = copyColor.disabled = true;
    } else {
      rgbEl.textContent = p.rgb;
      hexEl.textContent = p.hex;
      sw.style.background = p.hex;
      copyHex.disabled = copyRGB.disabled = copyColor.disabled = false;
      copyHex.onclick = () => navigator.clipboard.writeText(p.hex);
      copyRGB.onclick = () => navigator.clipboard.writeText(p.rgb);
      copyColor.onclick = () => navigator.clipboard.writeText(p.hex);
    }
  }
  function imageCoordsFromMouse(e) {
    const rect = canvas.getBoundingClientRect();
    const cx = e.clientX - rect.left;
    const cy = e.clientY - rect.top;
    let px = cx / zoom;
    let py = cy / zoom;
    if (snapEl.checked) {
      px = Math.floor(px);
      py = Math.floor(py);
    } else {
      px = Math.min(base.width - 1, Math.max(0, Math.floor(px)));
      py = Math.min(base.height - 1, Math.max(0, Math.floor(py)));
    }
    return { px, py };
  }
  let selectedPixel = null;
  
  canvas.addEventListener('click', (e) => {
    const { px, py } = imageCoordsFromMouse(e);
    
    // Se clicar no mesmo pixel, limpa a seleção
    if (selectedPixel && selectedPixel.x === px && selectedPixel.y === py) {
      selectedPixel = null;
      updateInfo(null, null);
    } else {
      // Seleciona o novo pixel
      selectedPixel = { x: px, y: py };
      updateInfo(px, py);
    }
    
    // Redesenha o canvas para mostrar o indicador
    draw();
  });
  setFromHoverBtn.addEventListener('click', () => {
    if (!selectedPixel) return;
    originXEl.value = selectedPixel.x;
    originYEl.value = selectedPixel.y;
    updateInfo(selectedPixel.x, selectedPixel.y);
  });
  zoomEl.addEventListener('input', e => setZoom(e.target.value));
  gridEl.addEventListener('change', draw);
  snapEl.addEventListener('change', draw);
  resizeEl.addEventListener('change', () => currentImg && loadImage(currentImg));
  twEl.addEventListener('change', () => currentImg && loadImage(currentImg));
  thEl.addEventListener('change', () => currentImg && loadImage(currentImg));
  customOriginEl.addEventListener('change', () => {
    if (selectedPixel) updateInfo(selectedPixel.x, selectedPixel.y);
  });
  originXEl.addEventListener('input', () => {
    if (selectedPixel) updateInfo(selectedPixel.x, selectedPixel.y);
  });
  originYEl.addEventListener('input', () => {
    if (selectedPixel) updateInfo(selectedPixel.x, selectedPixel.y);
  });
  originModeEls.forEach(r => r.addEventListener('change', () => {
    if (selectedPixel) updateInfo(selectedPixel.x, selectedPixel.y);
  }));
  let currentImg = null;
  file.addEventListener('change', () => {
    const f = file.files?.[0];
    if (!f) return;
    const url = URL.createObjectURL(f);
    const img = new Image();
    img.onload = () => { currentImg = img; loadImage(img); URL.revokeObjectURL(url); };
    img.src = url;
  });
  document.addEventListener('dragover', e => e.preventDefault());
  document.addEventListener('drop', e => {
    e.preventDefault();
    const f = e.dataTransfer.files?.[0];
    if (f) { file.files = e.dataTransfer.files; file.dispatchEvent(new Event('change')); }
  });
})();
</script>
<a href="#" class="scrollup" id="scroll-up">
  <i class="uil uil-arrow-up scrollup__icon"></i>
</a>
<script src="./assets/js/main.js"></script>
</body>
</html>
