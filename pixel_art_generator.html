<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pixel Inspector | Mustafa Neto</title>
    <link
      rel="stylesheet"
      href="https://unicons.iconscout.com/release/v4.0.0/css/line.css"
    />
    <link rel="stylesheet" href="./assets/css/style.css" />
  </head>
  <body class="pixel-art">
    <header class="header" id="header">
      <nav class="nav container">
        <a href="index.html" class="nav__logo">Mustafa</a>
        <div class="nav__menu" id="nav-menu">
          <ul class="nav__list grid">
            <li class="nav__item">
              <a href="utilidades.html" class="nav__link">
                <i class="uil uil-apps nav__icon"></i>
                Voltar às Utilidades
              </a>
            </li>
          </ul>
          <i class="uil uil-times nav__close" id="nav-close"></i>
        </div>
        <div class="nav__btns">
          <i class="uil uil-moon change-theme" id="theme-button"></i>
          <div class="nav__toggle" id="nav-toggle">
            <i class="uil uil-apps"></i>
          </div>
        </div>
      </nav>
    </header>

    <main class="main">
      <section class="utilities section" id="utilities">
        <h2 class="section__title">Pixel Inspector</h2>
        <span class="section__subtitle">Ferramenta para inspecionar pixels</span>

        <div class="utilities__container container grid">
          <div class="utilities__content">
            <div class="utilities__header">
              <i class="uil uil-brush-alt utilities__icon"></i>
              <h3 class="utilities__title">Pixel Inspector</h3>
            </div>

            <div class="utilities__tool">
              <p class="utilities__description">
                Clique em um pixel para selecioná-lo e ver suas informações.
                Clique novamente no mesmo pixel para deselecionar.
              </p>

              <div class="row">
                <label>Image: <input id="file" type="file" accept="image/*" /></label>
                <label>Target W: <input id="tw" type="number" value="75" min="1" /></label>
                <label>Target H: <input id="th" type="number" value="76" min="1" /></label>
                <label><input id="resize" type="checkbox" checked /> Resize to target (nearest‑neighbor)</label>
                <label><input id="grid" type="checkbox" checked /> Show grid</label>
                <label><input id="snap" type="checkbox" checked /> Snap to pixel</label>
                <label>Zoom: <input id="zoom" type="range" min="1" max="32" step="1" value="8" /></label>
              </div>

              <div class="pixel-art-container">
                <div class="canvas-container">
                  <canvas id="view" width="800" height="600"></canvas>
                </div>
                <div class="info-panel">
                  <div class="kv">Image size (px): <span id="size">–</span></div>
                  <div class="kv">Cursor (displayed): <span id="pos">–</span></div>
                  <div class="kv">Image coords: <span id="ipos">–</span></div>
                  <div class="kv">
                    Color: <span id="colorName">–</span> <span id="rgb">–</span> <span id="hex">–</span>
                    <span id="sw" class="swatch"></span>
                  </div>
                  <div class="row">
                    <button id="copyHex" disabled>Copy HEX</button>
                    <button id="copyRGB" disabled>Copy RGB</button>
                    <button id="copyColor" disabled>Copy Color</button>
                  </div>
                </div>
              </div>
              
              <div class="custom-origin-section">
                <fieldset>
                  <legend>Custom Origin</legend>
                  <div class="row">
                    <label><input id="customOrigin" type="checkbox" /> Use custom origin</label>
                  </div>
                  <div class="row">
                    <label>OX: <input id="originX" type="number" value="0" /></label>
                    <label>OY: <input id="originY" type="number" value="0" /></label>
                    <button id="setFromHover" title="Set OX/OY from selected pixel">Set from Selection</button>
                  </div>
                  <div class="row row--start">
                    <fieldset>
                      <legend>Mode</legend>
                      <label title="image (0,0) will be displayed as (OX, OY)">
                        <input type="radio" name="originMode" value="offset" checked /> Offset
                      </label><br />
                      <label title="coord (0,0) equals image (OX, OY); e.g., set OX=1723, OY=2424">
                        <input type="radio" name="originMode" value="anchor" /> Anchor
                      </label>
                    </fieldset>
                    <div class="pixel-notes">
                      <b>Offset</b>: displayed = (imgX + OX, imgY + OY).<br />
                      <b>Anchor</b>: displayed = (imgX − OX, imgY − OY).<br />
                      Example: to make <i>coord (0,0)</i> be image pixel <i>(1723,2424)</i>, choose <b>Anchor</b> and set OX=<b>1723</b>, OY=<b>2424</b>.
                    </div>
                  </div>
                </fieldset>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
<footer class="footer">
  <div class="footer__bg">
    <div class="footer__container container grid">
      <div>
        <h1 class="footer__title">Mustafa</h1>
        <span class="footer__subtitle"> Desenvolvedor Fullstack </span>
      </div>
      <ul class="footer__links">
        <li>
          <a href="index.html" class="footer__link">Portfólio</a>
        </li>
      </ul>
      <div class="footer__socials">
        <a href="https://github.com/mustafaneto" target="_blank" class="footer__social"><i class="uil uil-github-alt"></i></a>
        <a href="https://www.linkedin.com/in/mustafaneto/" target="_blank" class="footer__social"><i class="uil uil-linkedin-alt"></i></a>
      </div>
    </div>
  </div>
</footer>

  <script>
(() => {
  const $ = id => document.getElementById(id);
  const file = $('file');
  const canvas = $('view');
  const ctx = canvas.getContext('2d', { willReadFrequently: true });
  const zoomEl = $('zoom');
  const gridEl = $('grid');
  const snapEl = $('snap');
  const resizeEl = $('resize');
  const twEl = $('tw');
  const thEl = $('th');
  const sizeEl = $('size');
  const posEl = $('pos');
  const iposEl = $('ipos');
  const rgbEl = $('rgb');
  const colorNameEl = $('colorName');
  const hexEl = $('hex');
  const sw = $('sw');
  const copyHex = $('copyHex');
  const copyRGB = $('copyRGB');
  const copyColor = $('copyColor');
  const customOriginEl = $('customOrigin');
  const originXEl = $('originX');
  const originYEl = $('originY');
  const setFromHoverBtn = $('setFromHover');
  const originModeEls = document.querySelectorAll('input[name="originMode"]');
  let base = document.createElement('canvas');
  let bctx = base.getContext('2d', { willReadFrequently: true });
  let zoom = +zoomEl.value;
  const palette = [
    { r: 0, g: 0, b: 0, name: 'Black' },
    { r: 60, g: 60, b: 60, name: 'Dark Gray' },
    { r: 120, g: 120, b: 120, name: 'Gray' },
    { r: 170, g: 170, b: 170, name: 'Medium Gray' },
    { r: 210, g: 210, b: 210, name: 'Light Gray' },
    { r: 255, g: 255, b: 255, name: 'White' },
    { r: 96, g: 0, b: 24, name: 'Deep Red' },
    { r: 165, g: 14, b: 30, name: 'Dark Red' },
    { r: 237, g: 28, b: 36, name: 'Red' },
    { r: 250, g: 128, b: 114, name: 'Light Red' },
    { r: 228, g: 92, b: 26, name: 'Dark Orange' },
    { r: 255, g: 127, b: 39, name: 'Orange' },
    { r: 246, g: 170, b: 9, name: 'Gold' },
    { r: 249, g: 221, b: 59, name: 'Yellow' },
    { r: 255, g: 250, b: 188, name: 'Light Yellow' },
    { r: 156, g: 132, b: 49, name: 'Dark Goldenrod' },
    { r: 197, g: 173, b: 49, name: 'Goldenrod' },
    { r: 232, g: 212, b: 95, name: 'Light Goldenrod' },
    { r: 74, g: 107, b: 58, name: 'Dark Olive' },
    { r: 90, g: 148, b: 74, name: 'Olive' },
    { r: 132, g: 197, b: 115, name: 'Light Olive' },
    { r: 14, g: 185, b: 104, name: 'Dark Green' },
    { r: 19, g: 230, b: 123, name: 'Green' },
    { r: 135, g: 255, b: 94, name: 'Light Green' },
    { r: 12, g: 129, b: 110, name: 'Dark Teal' },
    { r: 16, g: 174, b: 166, name: 'Teal' },
    { r: 19, g: 225, b: 190, name: 'Light Teal' },
    { r: 15, g: 121, b: 159, name: 'Dark Cyan' },
    { r: 96, g: 247, b: 242, name: 'Cyan' },
    { r: 187, g: 250, b: 242, name: 'Light Cyan' },
    { r: 40, g: 80, b: 158, name: 'Dark Blue' },
    { r: 64, g: 147, b: 228, name: 'Blue' },
    { r: 125, g: 199, b: 255, name: 'Light Blue' },
    { r: 77, g: 49, b: 184, name: 'Dark Indigo' },
    { r: 107, g: 80, b: 246, name: 'Indigo' },
    { r: 153, g: 177, b: 251, name: 'Light Indigo' },
    { r: 74, g: 66, b: 132, name: 'Dark Slate Blue' },
    { r: 122, g: 113, b: 196, name: 'Slate Blue' },
    { r: 181, g: 174, b: 241, name: 'Light Slate Blue' },
    { r: 120, g: 12, b: 153, name: 'Dark Purple' },
    { r: 170, g: 56, b: 185, name: 'Purple' },
    { r: 224, g: 159, b: 249, name: 'Light Purple' },
    { r: 203, g: 0, b: 122, name: 'Dark Pink' },
    { r: 236, g: 31, b: 128, name: 'Pink' },
    { r: 243, g: 141, b: 169, name: 'Light Pink' },
    { r: 155, g: 82, b: 73, name: 'Dark Peach' },
    { r: 209, g: 128, b: 120, name: 'Peach' },
    { r: 250, g: 182, b: 164, name: 'Light Peach' },
    { r: 104, g: 70, b: 52, name: 'Dark Brown' },
    { r: 149, g: 104, b: 42, name: 'Brown' },
    { r: 219, g: 164, b: 99, name: 'Light Brown' },
    { r: 123, g: 99, b: 82, name: 'Dark Tan' },
    { r: 156, g: 132, b: 107, name: 'Tan' },
    { r: 214, g: 181, b: 148, name: 'Light Tan' },
    { r: 209, g: 128, b: 81, name: 'Dark Belge' },
    { r: 248, g: 178, b: 119, name: 'Belge' },
    { r: 255, g: 197, b: 165, name: 'Light Belge' },
    { r: 109, g: 100, b: 63, name: 'Dark Stone' },
    { r: 148, g: 140, b: 107, name: 'Stone' },
    { r: 205, g: 197, b: 158, name: 'Light Stone' },
    { r: 51, g: 57, b: 65, name: 'Dark Slate' },
    { r: 109, g: 117, b: 141, name: 'Slate' },
    { r: 179, g: 185, b: 209, name: 'Light Slate' }
  ];
  function currentOriginMode() {
    return [...originModeEls].find(r => r.checked)?.value || 'offset';
  }
  function setZoom(z) { zoom = +z; draw(); }
  function loadImage(img) {
    const targetW = Math.max(1, +twEl.value|0);
    const targetH = Math.max(1, +thEl.value|0);
    const src = document.createElement('canvas');
    const sctx = src.getContext('2d');
    src.width = img.naturalWidth;
    src.height = img.naturalHeight;
    sctx.drawImage(img, 0, 0);
    if (resizeEl.checked) {
      base.width = targetW;
      base.height = targetH;
      bctx.imageSmoothingEnabled = false;
      bctx.clearRect(0,0,base.width,base.height);
      bctx.drawImage(src, 0, 0, src.width, src.height, 0, 0, targetW, targetH);
    } else {
      base.width = src.width;
      base.height = src.height;
      bctx.clearRect(0,0,base.width,base.height);
      bctx.drawImage(src, 0, 0);
    }
    sizeEl.textContent = `${base.width} × ${base.height}`;
    applyPalette();
    draw();
  }

  function applyPalette() {
    const imgData = bctx.getImageData(0, 0, base.width, base.height);
    const data = imgData.data;
    for (let i = 0; i < data.length; i += 4) {
      const r = data[i], g = data[i + 1], b = data[i + 2];
      let best = palette[0];
      let bestDist = Infinity;
      for (const col of palette) {
        const dr = r - col.r;
        const dg = g - col.g;
        const db = b - col.b;
        const dist = dr * dr + dg * dg + db * db;
        if (dist < bestDist) {
          bestDist = dist;
          best = col;
        }
      }
      data[i] = best.r;
      data[i + 1] = best.g;
      data[i + 2] = best.b;
    }
    bctx.putImageData(imgData, 0, 0);
  }
  function draw() {
    canvas.width = base.width * zoom;
    canvas.height = base.height * zoom;
    ctx.imageSmoothingEnabled = false;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(base, 0, 0, base.width, base.height, 0, 0, canvas.width, canvas.height);
    if (gridEl.checked && zoom >= 3) {
      ctx.save();
      ctx.strokeStyle = 'rgba(0,0,0,0.25)';
      ctx.lineWidth = 1;
      for (let x = 0; x <= base.width; x++) {
        ctx.beginPath();
        ctx.moveTo(x * zoom + 0.5, 0);
        ctx.lineTo(x * zoom + 0.5, canvas.height);
        ctx.stroke();
      }
      for (let y = 0; y <= base.height; y++) {
        ctx.beginPath();
        ctx.moveTo(0, y * zoom + 0.5);
        ctx.lineTo(canvas.width, y * zoom + 0.5);
        ctx.stroke();
      }
      ctx.restore();
    }
    
    // Desenha indicador do pixel selecionado
    if (selectedPixel) {
      ctx.save();
      ctx.strokeStyle = '#ff0000';
      ctx.lineWidth = 2;
      const x = selectedPixel.x * zoom;
      const y = selectedPixel.y * zoom;
      ctx.strokeRect(x, y, zoom, zoom);
      ctx.restore();
    }
  }
  function getPixel(x, y) {
    if (x < 0 || y < 0 || x >= base.width || y >= base.height) return null;
    const d = bctx.getImageData(x, y, 1, 1).data;
    const rgb = `rgb(${d[0]}, ${d[1]}, ${d[2]})`;
    const hex = '#' + [d[0], d[1], d[2]].map(v => v.toString(16).padStart(2, '0')).join('');
    const name = palette.find(c => c.r === d[0] && c.g === d[1] && c.b === d[2])?.name || 'Unknown';
    return { r: d[0], g: d[1], b: d[2], a: d[3], rgb, hex, name };
  }
  function displayFromImage(px, py) {
    const ox = +originXEl.value || 0;
    const oy = +originYEl.value || 0;
    const mode = currentOriginMode();
    if (!customOriginEl.checked) return { x: px, y: py };
    if (mode === 'offset') return { x: px + ox, y: py + oy };
    else return { x: px - ox, y: py - oy };
  }
  function updateInfo(px, py) {
    if (px == null || py == null) {
      posEl.textContent = '–';
      iposEl.textContent = '–';
    } else {
      const disp = displayFromImage(px, py);
      posEl.textContent = `(${disp.x}, ${disp.y})`;
      iposEl.textContent = `(${px}, ${py})`;
    }
    const p = (px == null) ? null : getPixel(px, py);
    if (!p) {
      colorNameEl.textContent = '–';
      rgbEl.textContent = '–';
      hexEl.textContent = '–';
      sw.style.background = 'transparent';
      copyHex.disabled = copyRGB.disabled = copyColor.disabled = true;
    } else {
      colorNameEl.textContent = p.name;
      rgbEl.textContent = p.rgb;
      hexEl.textContent = p.hex;
      sw.style.background = p.hex;
      copyHex.disabled = copyRGB.disabled = copyColor.disabled = false;
      copyHex.onclick = () => navigator.clipboard.writeText(p.hex);
      copyRGB.onclick = () => navigator.clipboard.writeText(p.rgb);
      copyColor.onclick = () => navigator.clipboard.writeText(p.name);
    }
  }
  function imageCoordsFromMouse(e) {
    const rect = canvas.getBoundingClientRect();
    const cx = e.clientX - rect.left;
    const cy = e.clientY - rect.top;
    let px = cx / zoom;
    let py = cy / zoom;
    if (snapEl.checked) {
      px = Math.floor(px);
      py = Math.floor(py);
    } else {
      px = Math.min(base.width - 1, Math.max(0, Math.floor(px)));
      py = Math.min(base.height - 1, Math.max(0, Math.floor(py)));
    }
    return { px, py };
  }
  let selectedPixel = null;
  
  canvas.addEventListener('click', (e) => {
    const { px, py } = imageCoordsFromMouse(e);
    
    // Se clicar no mesmo pixel, limpa a seleção
    if (selectedPixel && selectedPixel.x === px && selectedPixel.y === py) {
      selectedPixel = null;
      updateInfo(null, null);
    } else {
      // Seleciona o novo pixel
      selectedPixel = { x: px, y: py };
      updateInfo(px, py);
    }
    
    // Redesenha o canvas para mostrar o indicador
    draw();
  });
  setFromHoverBtn.addEventListener('click', () => {
    if (!selectedPixel) return;
    originXEl.value = selectedPixel.x;
    originYEl.value = selectedPixel.y;
    updateInfo(selectedPixel.x, selectedPixel.y);
  });
  zoomEl.addEventListener('input', e => setZoom(e.target.value));
  gridEl.addEventListener('change', draw);
  snapEl.addEventListener('change', draw);
  resizeEl.addEventListener('change', () => currentImg && loadImage(currentImg));
  twEl.addEventListener('change', () => currentImg && loadImage(currentImg));
  thEl.addEventListener('change', () => currentImg && loadImage(currentImg));
  customOriginEl.addEventListener('change', () => {
    if (selectedPixel) updateInfo(selectedPixel.x, selectedPixel.y);
  });
  originXEl.addEventListener('input', () => {
    if (selectedPixel) updateInfo(selectedPixel.x, selectedPixel.y);
  });
  originYEl.addEventListener('input', () => {
    if (selectedPixel) updateInfo(selectedPixel.x, selectedPixel.y);
  });
  originModeEls.forEach(r => r.addEventListener('change', () => {
    if (selectedPixel) updateInfo(selectedPixel.x, selectedPixel.y);
  }));
  let currentImg = null;
  file.addEventListener('change', () => {
    const f = file.files?.[0];
    if (!f) return;
    const url = URL.createObjectURL(f);
    const img = new Image();
    img.onload = () => { currentImg = img; loadImage(img); URL.revokeObjectURL(url); };
    img.src = url;
  });
  document.addEventListener('dragover', e => e.preventDefault());
  document.addEventListener('drop', e => {
    e.preventDefault();
    const f = e.dataTransfer.files?.[0];
    if (f) { file.files = e.dataTransfer.files; file.dispatchEvent(new Event('change')); }
  });
})();
</script>
<a href="#" class="scrollup" id="scroll-up">
  <i class="uil uil-arrow-up scrollup__icon"></i>
</a>
<script src="./assets/js/main.js"></script>
</body>
</html>
